<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIXARIFY_ME</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import and styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .form-container {
            max-width: 600px;
            width: 100%;
            background-color: #ffffff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        /* Custom blue accent for the animation theme */
        .accent-bg {
            background-color: #4A90E2; 
        }
        .accent-text {
            color: #4A90E2;
        }
        /* Style the file input button nicely */
        /* Hides the default file input button */
        #hiddenPhotoInput {
            display: none;
        }
        .upload-button {
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="form-container p-6 sm:p-8 md:p-10 rounded-xl">
    <!-- Header -->
    <header class="text-center pb-6 border-b-2 border-gray-100">
        <h1 class="text-3xl sm:text-4xl font-extrabold accent-text">PIXARIFY_ME ðŸŽ¨</h1>
        <p class="text-gray-500 mt-2 text-lg">Your photo, transformed into magic. Personal Use Only.</p>
    </header>

    <!-- Pricing Disclaimer -->
    <div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg text-sm text-gray-700">
        <p class="font-semibold">Important Payment Note:</p>
        <p>This form provides an **ESTIMATED PRICE**. After submission, we will manually review your photo(s) and send you a **Personalized PayPal Invoice** for the required 50% deposit.</p>
    </div>

    <!-- COMMISSION FORM: NOW CONFIGURED FOR EMAIL SUBMISSION VIA FORMSUBMIT -->
    <form id="commissionForm" class="mt-8 space-y-6" action="https://formsubmit.co/pixarify@gmail.com" method="POST" enctype="multipart/form-data">
        
        <!-- Section 1: Contact & Referral -->
        <h2 class="text-xl font-bold border-b pb-2 accent-text">1. Contact & Basics</h2>
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700">Your Name</label>
            <input type="text" id="name" name="Name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg">
        </div>
        <div>
            <!-- IMPORTANT: Name changed to _replyto to capture the sender's email for easy reply -->
            <label for="email" class="block text-sm font-medium text-gray-700">Email Address (for Invoice)</label>
            <input type="email" id="email" name="_replyto" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg">
        </div>
        <div>
            <label for="instagram" class="block text-sm font-medium text-gray-700">Instagram Handle (for DMs & Tagging)</label>
            <input type="text" id="instagram" name="Instagram Handle" placeholder="@yourhandle" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg">
        </div>
        <div>
            <label for="referral" class="block text-sm font-medium text-gray-700">How did you hear about us?</label>
            <select id="referral" name="Referral Source" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg bg-white">
                <option value="instagram">Instagram</option>
                <option value="facebook">Facebook</option>
                <option value="youtube">YouTube</option>
                <option value="google">Google</option>
                <option value="referral">Friend/Referral</option>
                <option value="search">Online Search (General)</option>
                <option value="other">Other</option>
            </select>
        </div>
        
        <!-- Section 2: Order Details & Pricing -->
        <h2 class="text-xl font-bold border-b pb-2 accent-text pt-4">2. The Magic Details</h2>
        
        <!-- Number of Pictures -->
        <div>
            <label for="numPictures" class="block text-sm font-medium text-gray-700 mb-2">No. of Pictures to Transform (Max 5)</label>
            <input type="number" id="numPictures" name="Pictures Requested" value="1" min="1" max="5" onchange="calculatePrice()" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg">
            <p class="text-xs text-gray-500 mt-1">Note: Each photo transformation is priced separately based on the tier selected below.</p>
        </div>

        <!-- Style Selection -->
        <div>
            <label for="styleTier" class="block text-sm font-medium text-gray-700 mb-2">Select Style & Base Tier (Price is PER PHOTO)</label>
            <select id="styleTier" name="Style Selection" onchange="toggleOtherStyle(this.value); calculatePrice();" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg bg-white">
                <option value="" disabled selected>-- Choose a Style --</option>
                <option value="5">Tier 1: Pencil Sketch / Sketch (Base $5/Photo)</option>
                <option value="5">Tier 2: Classic Pixar Style (Base $5/Photo)</option>
                <option value="5">Tier 2: Stylized Pixar Style (Base $5/Photo)</option>
                <option value="5">Tier 2: GHIBLI Style (Base $5/Photo)</option>
                <option value="7">Tier 3: Surprise Me! (Base $7/Photo - Includes Complex Detail)</option>
                <option value="other">Other (Please Specify Below)</option>
            </select>
        </div>

        <!-- Other Style Specification -->
        <div id="otherStyleContainer" class="hidden">
            <label for="otherStyleText" class="block text-sm font-medium text-gray-700">Specify 'Other' Style</label>
            <input type="text" id="otherStyleText" name="Other Style Details" placeholder="e.g., Cyberpunk Anime, Vintage Comic" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg">
        </div>

        <!-- Extra Subjects -->
        <div>
            <label for="extraSubjects" class="block text-sm font-medium text-gray-700 mb-2">Extra People/Pets in the Picture ($2 per subject - total across all photos)</label>
            <input type="number" id="extraSubjects" name="Extra Subjects" value="0" min="0" onchange="calculatePrice()" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg">
        </div>

        <!-- Currency Selector (Used for Display only, price remains fixed USD) -->
        <div>
            <label for="currencySelect" class="block text-sm font-medium text-gray-700 mb-2">Select Currency for Estimate</label>
            <select id="currencySelect" onchange="calculatePrice()" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg bg-white">
                <option value="USD">USD ($)</option>
                <option value="INR">INR (â‚¹) - Estimated</option>
            </select>
        </div>

        <!-- File Upload -->
        <h2 class="text-xl font-bold border-b pb-2 accent-text pt-4">3. Photo Reference & Notes</h2>
        <div class="space-y-2">
            <!-- Hidden File Input (Used by JS to open dialog) -->
            <input type="file" id="hiddenPhotoInput" name="upload[]" accept="image/*" multiple max="5" onchange="handleNewFiles(event)">
            
            <!-- Custom Upload Button -->
            <label for="hiddenPhotoInput" class="upload-button w-full flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm text-base font-semibold text-white accent-bg hover:bg-blue-600 transition duration-150 ease-in-out">
                + Add Photo(s) (Max 5 Total)
            </label>
            
            <!-- File Name Display Container -->
            <div id="fileSummary" class="text-sm pt-1">
                <p id="fileCountText" class="text-gray-700 font-semibold">No files selected.</p>
                <ul id="fileList" class="mt-1 text-sm text-gray-600 space-y-1"></ul>
            </div>
            
            <!-- Clear Button -->
            <button type="button" onclick="clearPhotoUpload()" id="clearButton" class="p-2 text-sm font-medium text-red-600 bg-red-100 rounded-lg hover:bg-red-200 transition duration-150 ease-in-out w-full" style="display: none;">
                Clear All Uploaded Files
            </button>
            
            <!-- The actual file input field to submit the files is created dynamically in JS -->
            <div id="dynamicFileInputContainer" style="display: none;"></div>

            <p class="text-xs text-gray-500 mt-1">Note: FormSubmit will attach your files to the order email (up to 25MB total).</p>
        </div>
        <div>
            <label for="photoNotes" class="block text-sm font-medium text-gray-700">Notes/Description for Photos</label>
            <textarea id="photoNotes" name="Photo Notes" rows="2" placeholder="Describe which photo corresponds to which style, or any specific instructions (e.g., 'Make the person in Photo 1 look like the Ghibli style')." class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-accent-bg focus:border-accent-bg"></textarea>
        </div>
        
        <!-- Hidden Fields for Price Data Capture -->
        <input type="hidden" name="ESTIMATED TOTAL PRICE" id="hiddenTotalPrice">
        <input type="hidden" name="50% DEPOSIT DUE" id="hiddenDepositDue">

        <!-- Total Price Display -->
        <div class="pt-6 border-t-2 border-gray-200 space-y-3">
            <div class="flex justify-between items-center text-lg font-semibold">
                <span class="text-gray-700">ESTIMATED TOTAL PRICE:</span>
                <span id="totalPrice" class="accent-text text-2xl font-extrabold">$0.00</span>
            </div>
            <div class="flex justify-between items-center text-base font-medium p-2 bg-indigo-50 rounded-lg">
                <span class="text-gray-800">50% DEPOSIT DUE TO START:</span>
                <span id="depositDue" class="text-indigo-700 text-xl font-bold">$0.00</span>
            </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-bold text-white accent-bg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-bg transition duration-150 ease-in-out">
            Submit Order Request
        </button>

        <!-- FormSubmit Redirect/Honeypot -->
        <!-- This redirects the user back to the form page with a success message -->
        <input type="hidden" name="_next" value="[YOUR-HOSTED-FORM-URL]?submitted=true">
        <input type="text" name="_gotcha" style="display:none">
    </form>
    
</div>

<script>
    // Global storage array for all files
    let fileStorage = [];
    const MAX_FILES = 5;

    document.addEventListener('DOMContentLoaded', () => {
        // Run calculation on load
        calculatePrice();
        
        // FormSubmit Success Handling
        if (window.location.search.includes('submitted=true')) {
            const formContainer = document.querySelector('.form-container');
            // This is the success message HTML that replaces the form content
            formContainer.innerHTML = `
                <div class="p-6 bg-green-50 border-t-4 border-green-600 rounded-xl text-center">
                    <h3 class="text-3xl font-extrabold text-green-700 mb-4">Order Submitted Successfully! ðŸŽ‰</h3>
                    <p class="text-gray-800 text-lg">Thank you! Your order request and photo(s) have been sent.</p>
                    <p class="mt-4 text-lg font-semibold text-gray-900">Your Next Step:</p>
                    <ol class="list-decimal list-inside mt-2 space-y-2 text-gray-700 text-left mx-auto max-w-sm">
                        <li>We will **review your image(s)** and confirm the final price.</li>
                        <li>You will receive a **Personalized PayPal Invoice** for the **50% deposit** via the email you provided within 1-2 hours.</li>
                        <li>We begin work immediately after payment is confirmed!</li>
                    </ol>
                    <a href="${window.location.pathname}" class="mt-6 inline-block bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition">Start New Order</a>
                </div>
            `;
        }

        // Attach event listener to the form to handle dynamic file submission
        document.getElementById('commissionForm').addEventListener('submit', prepareFormForSubmission);
    });
    
    // Fixed conversion rate for estimation purposes
    const INR_RATE = 83.00; 

    // Function to show/hide the 'Other' style text box
    function toggleOtherStyle(selectedValue) {
        const container = document.getElementById('otherStyleContainer');
        if (selectedValue === 'other') {
            container.classList.remove('hidden');
        } else {
            container.classList.add('hidden');
            document.getElementById('otherStyleText').value = ''; // Clear text if hidden
        }
    }
    
    /**
     * Handles new files selected by the user, appending them to fileStorage.
     */
    function handleNewFiles(event) {
        const newFiles = event.target.files;
        
        if (fileStorage.length + newFiles.length > MAX_FILES) {
            alert(`You can only upload a maximum of ${MAX_FILES} files. Please clear your current selection or reduce the number of files.`);
            // Reset the hidden file input so the user can try again
            event.target.value = null; 
            return;
        }

        // Append new files to the global storage
        for (let i = 0; i < newFiles.length; i++) {
            fileStorage.push(newFiles[i]);
        }
        
        // Clear the hidden file input to allow re-selection of files
        event.target.value = null;

        displayFileNames();
    }
    
    /**
     * Clears the file input field and the displayed file list.
     */
    function clearPhotoUpload() {
        fileStorage = []; // Clears the global file storage array
        
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = ''; // Clears the list display
        
        const fileCountText = document.getElementById('fileCountText');
        fileCountText.textContent = 'No files selected.'; // Clears the total count text
        
        document.getElementById('clearButton').style.display = 'none';
        
        // Remove old dynamic inputs to ensure clean slate
        const container = document.getElementById('dynamicFileInputContainer');
        container.innerHTML = '';
    }
    
    /**
     * Displays the names and count of all currently selected files.
     */
    function displayFileNames() {
        const fileList = document.getElementById('fileList');
        const fileCountText = document.getElementById('fileCountText');
        
        fileList.innerHTML = ''; // Clear existing list
        
        const fileCount = fileStorage.length;
        
        if (fileCount > 0) {
            // Update the total count text
            fileCountText.textContent = `Total Files Uploaded: ${fileCount}`;
            document.getElementById('clearButton').style.display = 'block';

            // List individual file names
            fileStorage.forEach(file => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center';
                // Display file name with a checkmark icon (tailwind class)
                listItem.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><span>${file.name}</span>`;
                fileList.appendChild(listItem);
            });
        } else {
             fileCountText.textContent = 'No files selected.';
             document.getElementById('clearButton').style.display = 'none';
        }
    }

    /**
     * Updates the hidden fields with the final calculated price for submission.
     */
    function updateHiddenPriceFields(estimatedTotalUSD, depositAmountUSD) {
        // We submit the price in USD, regardless of the display currency
        document.getElementById('hiddenTotalPrice').value = `$${estimatedTotalUSD.toFixed(2)} USD`;
        document.getElementById('hiddenDepositDue').value = `$${depositAmountUSD.toFixed(2)} USD`;
    }

    /**
     * Prepares the form for final submission by dynamically creating file inputs for FormSubmit.
     */
    function prepareFormForSubmission(event) {
        if (fileStorage.length === 0) {
            alert('Please upload at least one photo reference to submit your order.');
            event.preventDefault();
            return;
        }

        const container = document.getElementById('dynamicFileInputContainer');
        container.innerHTML = ''; // Clear previous inputs

        // Create a new file input element for submission
        // FormData will read the content of this input field
        const dataTransfer = new DataTransfer();
        fileStorage.forEach(file => dataTransfer.items.add(file));

        const finalInput = document.createElement('input');
        finalInput.setAttribute('type', 'file');
        finalInput.setAttribute('name', 'upload[]'); // Crucial for FormSubmit multi-file
        finalInput.files = dataTransfer.files;
        
        container.appendChild(finalInput);
        
        // Allow native form submission to proceed
    }


    /**
     * Calculates the estimated total price and required deposit based on user selections.
     */
    function calculatePrice() {
        const styleTierElement = document.getElementById('styleTier');
        const numPicturesElement = document.getElementById('numPictures');
        const extraSubjectsElement = document.getElementById('extraSubjects');
        const currencyElement = document.getElementById('currencySelect');

        let basePricePerImage = parseFloat(styleTierElement.value) || 0;
        
        // Handle 'Other' selection for price estimation: if 'other' is selected, 
        // default to the standard Tier 2 price ($5) for the estimate.
        if (styleTierElement.value === 'other') {
            basePricePerImage = 5; 
        }

        // 1. Calculate total base cost in USD
        const numPictures = parseInt(numPicturesElement.value) || 1;
        const totalBaseCostUSD = basePricePerImage * numPictures;
        
        // Calculate extra subjects cost ($2/subject)
        const extraSubjects = parseInt(extraSubjectsElement.value) || 0;
        const subjectsCostUSD = extraSubjects * 2; 

        // Add-on costs are zeroed out as requested
        const rushFeeCostUSD = 0; 
        const promptDeliveryCostUSD = 0;

        // 2. Calculate final prices in USD
        const estimatedTotalUSD = totalBaseCostUSD + subjectsCostUSD + rushFeeCostUSD + promptDeliveryCostUSD;
        const depositAmountUSD = estimatedTotalUSD * 0.5;
        
        // Update hidden fields before displaying (for submission)
        updateHiddenPriceFields(estimatedTotalUSD, depositAmountUSD);

        // 3. Apply currency conversion for DISPLAY
        const selectedCurrency = currencyElement.value;
        let totalPriceDisplay, depositDisplay;
        
        if (selectedCurrency === 'INR') {
            const finalTotalINR = estimatedTotalUSD * INR_RATE;
            const finalDepositINR = depositAmountUSD * INR_RATE;
            // Format to nearest whole rupee
            totalPriceDisplay = `â‚¹${finalTotalINR.toFixed(0)}`; 
            depositDisplay = `â‚¹${finalDepositINR.toFixed(0)}`;
        } else { // Default to USD
            totalPriceDisplay = `$${estimatedTotalUSD.toFixed(2)}`;
            depositDisplay = `$${depositAmountUSD.toFixed(2)}`;
        }

        // 4. Display results
        document.getElementById('totalPrice').textContent = totalPriceDisplay;
        document.getElementById('depositDue').textContent = depositDisplay;
    }
</script>

</body>
</html>
